<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SR Truck Quote Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f9fc;
      margin: 20px;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
    }
    th {
      background: #e6f2ff;
      text-align: center;
    }
    td[contenteditable="true"] {
      cursor: text;
    }
    tr:nth-child(even) {
      background-color: #e6f2ff;
    }
    tr.dragging {
      opacity: 0.6;
    }
    .actions {
      text-align: center;
      width: 100px;
    }
    button {
      padding: 4px 8px;
      border-radius: 6px;
      border: 1px solid #999;
      background: #f0f0f0;
      cursor: pointer;
      margin: 2px;
      font-size: 12px;
    }
    button:hover {
      background: #d9e6f2;
    }
    #copyQuoteBtn {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #444;
      background: #e6f2ff;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>SR Truck Quote Builder</h2>

  <table id="quoteTable">
    <thead>
      <tr>
        <th>Description of Work to be Performed</th>
        <th>Total $</th>
        <th class="actions">Actions</th>
      </tr>
    </thead>
    <tbody id="quoteBody">
      <tr draggable="true">
        <td contenteditable="true">Example task</td>
        <td contenteditable="true">$0.00</td>
        <td class="actions">
          <button onclick="insertRow(this)">+</button>
          <button onclick="deleteRow(this)">üóë</button>
        </td>
      </tr>
    </tbody>
    <tfoot>
      <tr>
        <td style="text-align:right; font-weight:bold;">Total</td>
        <td id="grandTotal" style="text-align:right; font-weight:bold;">$0.00</td>
        <td></td>
      </tr>
    </tfoot>
  </table>

  <button id="copyQuoteBtn" type="button">Copy Quote for Striven</button>

  <script>
    // --- Format Total $ inputs as currency ---
    document.querySelector('#quoteBody').addEventListener('input', e => {
      if (e.target.cellIndex === 1) {
        let val = e.target.innerText.replace(/[^0-9.]/g, '');
        const num = parseFloat(val);
        if (!isNaN(num)) {
          e.target.innerText = num.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
        }
        updateTotal();
      }
    });

    // --- Add/Delete rows ---
    function insertRow(btn) {
      const row = btn.closest('tr');
      const newRow = row.cloneNode(true);
      newRow.querySelectorAll('td')[0].innerText = '';
      newRow.querySelectorAll('td')[1].innerText = '$0.00';
      row.parentNode.insertBefore(newRow, row.nextSibling);
      addDragEvents(newRow);
      updateRowColors();
      updateTotal();
    }

    function deleteRow(btn) {
      const row = btn.closest('tr');
      const body = document.getElementById('quoteBody');
      if (body.rows.length > 1) {
        row.remove();
      } else {
        alert('At least one row is required.');
      }
      updateRowColors();
      updateTotal();
    }

    // --- Alternating row colors ---
    function updateRowColors() {
      const rows = document.querySelectorAll('#quoteBody tr');
      rows.forEach((row, index) => {
        if (index % 2 === 1) row.setAttribute('bgcolor', '#e6f2ff');
        else row.removeAttribute('bgcolor');
      });
    }

    // --- Calculate total ---
    function updateTotal() {
      let total = 0;
      document.querySelectorAll('#quoteBody tr').forEach(row => {
        const val = row.cells[1].innerText.replace(/[^0-9.]/g, '');
        const num = parseFloat(val);
        if (!isNaN(num)) total += num;
      });
      document.getElementById('grandTotal').innerText = total.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
    }

    // --- Drag-and-drop rows ---
    function addDragEvents(row) {
      row.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', '');
        row.classList.add('dragging');
        draggedRow = row;
      });
      row.addEventListener('dragend', () => {
        row.classList.remove('dragging');
        updateRowColors();
      });
    }

    let draggedRow = null;
    document.getElementById('quoteBody').addEventListener('dragover', e => {
      e.preventDefault();
      const target = e.target.closest('tr');
      const body = document.getElementById('quoteBody');
      if (target && target !== draggedRow) {
        const rows = Array.from(body.children);
        const draggedIndex = rows.indexOf(draggedRow);
        const targetIndex = rows.indexOf(target);
        if (draggedIndex < targetIndex) body.insertBefore(draggedRow, target.nextSibling);
        else body.insertBefore(draggedRow, target);
      }
    });

    document.querySelectorAll('#quoteBody tr').forEach(addDragEvents);

    // --- Copy Striven-compatible HTML ---
    document.addEventListener('DOMContentLoaded', () => {
      const copyBtn = document.getElementById('copyQuoteBtn');
      copyBtn.addEventListener('click', () => {
        const rows = document.querySelectorAll('#quoteBody tr');
        if (!rows.length) return alert('‚ö†Ô∏è No rows to copy.');

        let total = 0;
        let html = `
<table border="1" cellpadding="5" cellspacing="0" style="width:100%; border-collapse:collapse; font-size:12pt;">
  <thead>
    <tr>
      <th style="text-align:center; width:85%; height:50px;">
        <font size="4">Description of Work to be Performed</font>
      </th>
      <th style="text-align:center; width:15%; height:50px;">
        <font size="4">Total $</font>
      </th>
    </tr>
  </thead>
  <tbody>
`;

        rows.forEach((row, index) => {
          const desc = (row.cells[0]?.innerText || '').trim();
          const amt = (row.cells[1]?.innerText || '').trim().replace(/[^0-9.]/g, '');
          const num = parseFloat(amt) || 0;
          total += num;
          const bgColor = index % 2 === 1 ? ' bgcolor="#e6f2ff"' : '';
          const displayAmt = num ? num.toLocaleString('en-US', { style: 'currency', currency: 'USD' }) : '';
          html += `
    <tr${bgColor}>
      <td style="text-align:left; height:25px;">${desc}</td>
      <td style="text-align:right; height:25px; font-size:10pt; color:rgba(102,102,102,1)">${displayAmt}</td>
    </tr>`;
        });

        const totalDisplay = total.toLocaleString('en-US', { style: 'currency', currency: 'USD' });

        html += `
    <tr>
      <td style="text-align:right; font-weight:bold; height:30px;">Total</td>
      <td style="text-align:right; font-weight:bold; height:30px;">${totalDisplay}</td>
    </tr>
  </tbody>
</table>`;

        navigator.clipboard.writeText(html.trim())
          .then(() => alert('‚úÖ Quote copied in Striven-compatible HTML format!'))
          .catch(() => {
            const tempEl = document.createElement('textarea');
            tempEl.value = html.trim();
            document.body.appendChild(tempEl);
            tempEl.select();
            document.execCommand('copy');
            document.body.removeChild(tempEl);
            alert('‚úÖ Quote copied in Striven-compatible HTML format!');
          });
      });
    });
  </script>
</body>
</html>
